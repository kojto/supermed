<odoo>
	<data>
		<!-- List Views -->
		<record model="ir.ui.view" id="view_trinity_referral_fetch_list">
			<field name="name">trinity.referral.fetch.list</field>
			<field name="model">trinity.referral.fetch</field>
			<field name="arch" type="xml">
				<list>
					<field name="main_dr_performing_doctor_id" optional="show"/>
					<field name="fetch_nrnReferral" optional="show"/>
					<field name="fetch_identifier_type" optional="show"/>
					<field name="fetch_identifier" optional="show"/>
					<field name="fetch_fromDate" optional="hide"/>
					<field name="fetch_toDate" optional="hide"/>
					<field name="fetch_category" optional="show"/>
					<field name="fetch_practiceNumber" optional="hide"/>
					<field name="R016" optional="hide"/>
				</list>
			</field>
		</record>
		<!-- Form Views -->
		<record model="ir.ui.view" id="view_trinity_referral_fetch_form">
			<field name="name">trinity.referral.fetch.form</field>
			<field name="model">trinity.referral.fetch</field>
			<field name="arch" type="xml">
				<form class="autoSaveScript">
					<style>
                        .o_form_view .o_form_sheet_bg {
                        margin: 0 auto !important;
                        }
						.o_list_renderer tbody tr:has(td[colspan]:only-child):not(:has(a)) {
						display: none !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="subject_full_name"] {
						max-width: 100px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="referral_authoredOn"] {
						max-width: 50px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="referral_category_name"] {
						max-width: 100px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="referral_qualification_name"] {
						max-width: 100px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="specializedActivities_code"] {
						max-width: 30px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="laboratory_code"] {
						max-width: 30px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						.o_list_renderer.o_renderer.table-responsive .o_list_table
						th[data-name="hospitalization_clinicalPathway"] {
						max-width: 30px !important; font-weight: bold !important;font-size: 12px
						!important;text-align: start !important;
						}
						table > thead > tr {
						border-left: 1px solid rgba(11, 83, 148, 0.2) !important;
						border-right: 1px solid rgba(11, 83, 148, 0.2) !important;
						border-bottom: 1px solid rgba(11, 83, 148, 0.2) !important;
						border-top: 1px solid rgba(11, 83, 148, 0.2) !important;
						}
						table > thead > tr > th {
						border-left: 0px !important;
						border-right: 0px !important;
						border-bottom: 0px !important;
						border-top: 0px !important;
						}
					</style>
					<link rel="stylesheet" type="text/css" href="/trinity_file_assets/static/src/css/custom.css"/>
					<link rel="stylesheet" type="text/css" href="/trinity_file_assets/static/src/css/remove_control_panel.css"/>
					<sheet>
						<div style="display: flex; justify-content: right;" invisible="incomming_referral_ids or error_reason">
							<div invisible="not user_token_is_expired">
								<button name="getToken" string="Изгради връзка с НЗИС" type="object" class="btn btn-outline-danger btn-sm" onclick="getToken()"/>
							</div>
							<div invisible="user_token_is_expired">
								<button name="getSignatureR015" string="Изпрати към НЗИС" type="object" class="btn btn-outline-primary btn-sm" onclick="getSignatureR015()"/>
							</div>
						</div>
						<div style="display: flex; justify-content: right;" invisible="not (incomming_referral_ids or error_reason)">
							<div>
								<button name="fetch_new_referral" string="Изтегли ново направление" type="object" class="btn btn-outline-primary btn-sm"/>
							</div>
						</div>
                        <div class="row" invisible="incomming_referral_ids">
                            <div class="fs-2 fw-bold text-primary text-center" invisible="error_reason">Изтегли направление от НЗИС</div>
                            <div class="fs-2 fw-bold text-danger text-center" invisible="not error_reason">Грешка от НЗИС</div>
                            <group class="col-lg-6 m-auto">
                                <separator class="col-lg-12 separator"/>
                                <field name="fetch_identifier_type" widget="input" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" readonly="error_reason"/>
                                <field name="fetch_identifier" widget="input" readonly="error_reason"/>
                                <field name="fetch_practiceNumber" widget="input" readonly="error_reason"/>
                            </group>
                        </div>
                        <div class="row" invisible="not error_reason">
                            <div class="col-lg-6 m-auto">
                                <separator class="col-lg-12 separator"/>
                                <div class="mb-4 fs-3 fw-bold text-danger">
                                    <field name="error_type" readonly="1" class="fs-3 fw-bold text-danger d-inline"/>
                                    <field name="error_reason" readonly="1" class="fs-3 fw-bold text-danger d-inline"/>
                                </div>
                            </div>
                        </div>
						<div class="row" invisible="not incomming_referral_ids">
                            <div class="mb-1 fs-2 fw-bold text-primary">Направление/я издадено/и за:</div>
                            <div class="mb-4 fs-2 fw-bold text-primary">
                                <field name="fetch_subject_full_name" readonly="1" nolabel="1"/>
                            </div>
							<div class="col-lg-12">
								<field name="incomming_referral_ids" nolabel="1">
									<list default_order="referral_authoredOn desc, referral_authoredOn desc" create="false" delete="false">
										<field name='referral_category_name'/>
										<field name='referral_qualification_name'/>
										<field name='specializedActivities_code'/>
                                        <field name='laboratory_code'/>
                                        <field name='hospitalization_clinicalPathway'/>
                                        <button name="create_trinity_examination_record" type="object" class="fa fa-external-link" aria-label="Създай преглед" title="Създай преглед"/>
                                    </list>
								</field>
							</div>
						</div>
						<group class='col-lg-12 d-none'>
							<field name="R015" id="R015" widget="text"/>
							<field name="R016" id="R016" widget="text"/>
							<field name="R016_raw" id="R016_raw" widget="text"/>
							<field name="SignedInfo_R015" id="SignedInfo_R015" widget="text"/>
							<field name="SignedInfo_R015_signature" id="SignedInfo_R015_signature" widget="text"/>
							<field name="user_token_certificate" id="user_token_certificate" widget="text"/>
							<field name="supermed_certificate" id="supermed_certificate" widget="text"/>
							<field name="R015_signed" id="R015_signed"/>
							<field name="tokenRequest" id="tokenRequest" widget="text"/>
							<field name="SignedInfo_tokenRequest" id="SignedInfo_tokenRequest" widget="text"/>
							<field name="SignedInfo_tokenRequest_signature" id="SignedInfo_tokenRequest_signature" widget="text"/>
							<field name="tokenRequest_signed" id="tokenRequest_signed" widget="text"/>
							<field name="tokenResponse" id="tokenResponse" widget="text"/>
							<field name="user_token_expiresOnDatetime"/>
							<field name="user_token_is_expired" id="user_token_is_expired"/>
						</group>
						<group class='col-lg-12 d-none'>
							<button name="R015_api_request" type="object"/>
							<button name="post_token_api_request" type="object"/>
						</group>
					</sheet>
					<script type="text/javascript" src="/trinity_file_assets/static/src/js/getToken.js"/>
					<script type="text/javascript" src="/trinity_file_assets/static/src/js/getSignature.js"/>
					<script type="text/javascript" src="/trinity_file_assets/static/src/js/getSignatureNhifMessages.js"/>
					<script type="text/javascript" src="/trinity_file_assets/static/src/js/autoSaveScript.js"/>
				</form>
			</field>
		</record>
		<!-- Actions to Return Model Views -->
		<record model="ir.actions.act_window" id="action_trinity_referral_fetch_form">
			<field name="name"/>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">trinity.referral.fetch</field>
			<field name="view_mode">form</field>
			<field name="target">current</field>
		</record>
		<record model="ir.actions.act_window" id="action_trinity_referral_fetch_list">
			<field name="name">Изтеглени направления</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">trinity.referral.fetch</field>
			<field name="view_mode">list,form</field>
			<field name="target">current</field>
			<field name="help" type="html">
				<p class="o_view_nocontent_smiling_face"/>
			</field>
		</record>
		<!-- Menu Items -->
		<menuitem name="Направления" id="menu_referral_parent" sequence="4"/>
		<menuitem name="Изтегли" id="menu_referral_fetch_form" parent="menu_referral_parent" action="action_trinity_referral_fetch_form" sequence="10"/>
		<menuitem name="Изтеглени направления" id="menu_referral_fetch_list" parent="menu_referral_parent" action="action_trinity_referral_fetch_list" sequence="40"/>
	</data>
</odoo>
